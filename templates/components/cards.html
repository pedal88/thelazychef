{% macro visual_ingredient(ri, size='md') %}
{#
A specialized macro to display an ingredient with its image.
Expects a RecipeIngredient object (ri) which has .ingredient relation and .amount/.unit fields.
#}
{% set ingredient = ri.ingredient %}
{% set size_classes = {
'sm': 'w-12 h-12',
'md': 'w-16 h-16',
'lg': 'w-24 h-24',
'xl': 'w-full aspect-square'
} %}

<div class="group/ing flex flex-col items-center {% if size == 'xl' %}w-full{% endif %}" data-ri-id="{{ ri.id }}">
    <div
        class="relative {{ size_classes[size] }} {% if size != 'xl' %}rounded-lg border {% if ingredient.main_category == 'Imported' %}border-red-500 border-2{% else %}border-slate-100{% endif %} p-1{% else %}rounded-md{% endif %} bg-white shadow-sm overflow-hidden transition-transform group-hover/ing:scale-105 group-hover/ing:shadow-md">
        {% if ingredient.image_url %}
        {% if ingredient.image_url.startswith('http://') or ingredient.image_url.startswith('https://') %}
        <img src="{{ ingredient.image_url }}" alt="{{ ingredient.name }}"
            class="w-full h-full {% if size == 'xl' %}object-cover{% else %}object-contain{% endif %}" loading="lazy">
        {% else %}
        <img src="{{ url_for('static', filename=ingredient.image_url) }}" alt="{{ ingredient.name }}"
            class="w-full h-full {% if size == 'xl' %}object-cover{% else %}object-contain{% endif %}" loading="lazy">
        {% endif %}
        {% else %}
        <!-- Fallback Gradient (should rarely adhere with 100% coverage) -->
        <div
            class="w-full h-full bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center text-xs text-slate-400 font-bold">
            {{ ingredient.name[:2] | upper }}
        </div>
        {% endif %}

        {# Admin Relink Button ‚Äî only visible to authenticated admins #}
        {% if current_user.is_authenticated and current_user.is_admin %}
        <button onclick="openRelinkModal({{ ri.id }}, '{{ ingredient.name|e }}')" title="Relink to different ingredient"
            class="absolute top-0 right-0 w-5 h-5 bg-indigo-600/80 hover:bg-indigo-700 text-white rounded-bl-md flex items-center justify-center opacity-0 group-hover/ing:opacity-100 transition-opacity duration-200 cursor-pointer z-10">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101" />
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M10.172 13.828a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101" />
            </svg>
        </button>
        {% endif %}
    </div>
    <span
        class="mt-2 text-xs font-medium text-slate-600 text-center leading-tight {% if size != 'xl' %}w-20 break-words{% endif %}">
        {{ ingredient.name }}
    </span>
    {# Since we passed the Link Object (RecipeIngredient), we can access amount directly #}
    {% if ri.amount %}
    <span class="text-[10px] text-slate-400 font-medium">
        {{ ri.amount|int if ri.amount == ri.amount|int else ri.amount }} <span class="text-[9px] uppercase">{{ ri.unit
            }}</span>
    </span>
    {% endif %}
</div>
{% endmacro %}

{% macro recipe_preview_card(recipe, id, show_inspector=False) %}
<a href="/recipe/{{ id }}"
    class="group block h-full bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-orange-200 transition-all duration-300 overflow-hidden flex flex-col">
    <!-- Image / Gradient Placeholder -->
    <div class="h-48 bg-slate-100 relative overflow-hidden">
        {% if recipe.image_filename %}
        <img src="{{ get_recipe_image_url(recipe) }}" alt="{{ recipe.title }}"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
        {% else %}
        <!-- Contextual Placeholder -->
        <div class="absolute inset-0 bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center">
            <span class="text-4xl">üç≥</span>
        </div>
        {% endif %}

        <!-- Favorite Button (Top Right) -->
        <div class="absolute top-2 right-2 z-20 flex gap-2">
            {% if show_inspector %}
            <button onclick="event.preventDefault(); event.stopPropagation(); openInspector({{ recipe.id }});"
                type="button"
                class="bg-black/40 hover:bg-black/70 text-white p-1.5 rounded-full backdrop-blur-sm transition-colors opacity-0 group-hover:opacity-100"
                title="Inspect Data">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
            </button>
            {% endif %}

            {% if current_user.is_authenticated %}
            <button type="button"
                class="favorite-btn bg-white/90 hover:bg-white text-slate-400 hover:text-red-500 p-1.5 rounded-full shadow-sm backdrop-blur-sm transition-all duration-200 transform hover:scale-110"
                data-recipe-id="{{ recipe.id }}" title="Save Recipe">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                    </path>
                </svg>
            </button>
            {% endif %}
        </div>
    </div>

    <div class="p-5 flex flex-col flex-grow">
        <!-- Meta -->
        <div class="flex items-center gap-2 mb-3">
            <span class="text-xs font-bold text-orange-600 uppercase tracking-wide">{{ recipe.cuisine }}</span>
            <span class="text-slate-300">‚Ä¢</span>
            <span class="text-xs text-slate-500">{{ recipe.difficulty }}</span>
        </div>

        <!-- Title -->
        <h3
            class="font-serif text-xl font-bold text-slate-900 mb-2 group-hover:text-orange-600 transition-colors line-clamp-2">
            {{ recipe.title }}
        </h3>

        <!-- Tags -->
        <div class="mt-auto pt-4 flex gap-2 overflow-x-auto hide-scrollbar">
            <span
                class="inline-flex items-center rounded-md bg-slate-50 px-2 py-1 text-xs font-medium text-slate-600 ring-1 ring-inset ring-slate-500/10">
                {{ recipe.diet }}
            </span>
            {% if recipe.protein_type %}
            <span
                class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">
                {{ recipe.protein_type }}
            </span>
            {% endif %}
        </div>
    </div>
</a>
{% endmacro %}

{% macro resource_preview_card(resource) %}
<a href="/become-a-chef/{{ resource.slug }}"
    class="group block h-full bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-200 transition-all duration-300 overflow-hidden flex flex-col">
    <!-- Image / Gradient Placeholder -->
    <div class="h-48 bg-slate-100 relative overflow-hidden">
        {% if resource.image_filename %}
        <img src="{{ resource.image_filename }}" alt="{{ resource.title }}"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
        {% else %}
        <div class="absolute inset-0 bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center">
            <span class="text-4xl">üìö</span>
        </div>
        {% endif %}
    </div>

    <div class="p-5 flex flex-col flex-grow">
        <!-- Meta -->
        <div class="flex items-center gap-2 mb-3">
            <span class="text-xs font-bold text-blue-600 uppercase tracking-wide">Article</span>
            <span class="text-slate-300">‚Ä¢</span>
            <span class="text-xs text-slate-500">{{ resource.meta.read_time }} min read</span>
        </div>

        <!-- Title -->
        <h3
            class="font-serif text-xl font-bold text-slate-900 mb-2 group-hover:text-blue-600 transition-colors line-clamp-2">
            {{ resource.title }}
        </h3>

        <p class="text-sm text-slate-600 line-clamp-3 mb-4">
            {{ resource.summary }}
        </p>

        <!-- Read More Link (Visual) -->
        <div class="mt-auto pt-2 flex items-center text-blue-600 font-medium text-sm group-hover:underline">
            Read Article <span class="ml-1">‚Üí</span>
        </div>
    </div>
</a>
{% endmacro %}