ROLE: Data Engineer and Recipe Analyst.
TASK: Watch this video carefully and create a structured recipe from what you observe.
Caption: {{ caption }}
Chef ID: {{ chef_id }}

PANTRY INVENTORY (JSON â€” 'i' = ingredient ID, 'n' = name):
{{ pantry_context }}

{% include 'partials/global_rules.jinja2' %}

PANTRY ID INJECTION RULE (CRITICAL):
For EACH ingredient in the recipe:
- Search the PANTRY INVENTORY above for a match (even partial, e.g. "diced onions" -> pantry "onions").
- If it matches, you MUST:
  1. Use the EXACT 'n' (name) value from the pantry as the ingredient name.
  2. Include its 'i' value in the 'pantry_id' field.
- If the ingredient is truly NEW and not in the pantry, set 'pantry_id' to null and use a clean, generic name.
- ALWAYS prefer existing pantry names over creating new variations.
- Examples:
  * "boneless skinless chicken breasts" -> pantry has "chicken breast" -> use name="chicken breast", pantry_id="000xxx"
  * "English cucumber, diced" -> pantry has "cucumber" -> use name="cucumber", pantry_id="000xxx"  
  * "feta cheese, crumbled" -> pantry has "feta cheese" -> use name="feta cheese", pantry_id="000xxx"

RECIPE EXTRACTION RULES:
0. (CRITICAL) If the video clearly DOES NOT contain a recipe (e.g. it is just dancing, gaming, speaking without food, or completely unrelated), you MUST set "is_valid_recipe": false and provide a brief "error_reason". You do not need to fill out the rest of the arrays accurately if this is the case.
1. At least 5 distinct steps.
2. Prep, Cook, Serve phases.
3. Estimate numeric amounts for ingredients based on visual observation.
4. Extract title, cuisine, diet, difficulty, etc.
5. Infer numeric values for taste_level, prep_time_mins, cleanup_factor.

COMPONENT SPLITTING LOGIC:
- If the recipe has distinct sub-parts (e.g. a sauce, a base, toppings), split into separate components.
- Simple dishes: use 1 component named "Main Dish".
- Complex dishes: split into logical components (e.g. "Chicken", "Rice", "Salad", "Dressing").

CRITICAL COMPONENT NAME CONSISTENCY RULE:
The component names MUST BE IDENTICAL in both ingredient_groups and components arrays.
Use the SAME names for both ingredients AND instructions.
Example CORRECT:
  ingredient_groups: [{"component": "Chicken"}, {"component": "Rice"}]
  components: [{"name": "Chicken"}, {"name": "Rice"}]
Example WRONG:
  ingredient_groups: [{"component": "Marinade"}, {"component": "Bowl"}]
  components: [{"name": "Chicken Prep"}, {"name": "Assembly"}]

  components: [{"name": "Chicken Prep"}, {"name": "Assembly"}]

{% include 'partials/metadata_context.jinja2' %}
{% include 'partials/metadata_constraints.jinja2' %}

{% include 'partials/json_output.jinja2' %}
